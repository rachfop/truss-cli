<!DOCTYPE html>
<html
  lang="en"
  dir="ltr"
  class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-main"
  data-has-hydrated="false"
>
  <head>
    <meta charset="UTF-8">
    <meta name="generator" content="Docusaurus v3.9.2">
    <title data-rh="true">
      Use Custom Docker Images in Truss | Use custom docker images in Truss
    </title>
    <meta
      data-rh="true"
      name="viewport"
      content="width=device-width,initial-scale=1"
    >
    <meta data-rh="true" name="twitter:card" content="summary_large_image">
    <meta
      data-rh="true"
      property="og:url"
      content="https://rachfop.github.io/main"
    >
    <meta data-rh="true" property="og:locale" content="en">
    <meta data-rh="true" name="docusaurus_locale" content="en">
    <meta data-rh="true" name="docsearch:language" content="en">
    <meta data-rh="true" name="docusaurus_version" content="current">
    <meta data-rh="true" name="docusaurus_tag" content="docs-default-current">
    <meta data-rh="true" name="docsearch:version" content="current">
    <meta
      data-rh="true"
      name="docsearch:docusaurus_tag"
      content="docs-default-current"
    >
    <meta
      data-rh="true"
      property="og:title"
      content="Use Custom Docker Images in Truss | Use custom docker images in Truss"
    >
    <meta
      data-rh="true"
      name="description"
      content="By default, Truss uses pre-built base images from baseten/truss-server-base that are optimized for ML workloads."
    >
    <meta
      data-rh="true"
      property="og:description"
      content="By default, Truss uses pre-built base images from baseten/truss-server-base that are optimized for ML workloads."
    >
    <link data-rh="true" rel="canonical" href="https://rachfop.github.io/main">
    <link
      data-rh="true"
      rel="alternate"
      href="https://rachfop.github.io/main"
      hreflang="en"
    >
    <link
      data-rh="true"
      rel="alternate"
      href="https://rachfop.github.io/main"
      hreflang="x-default"
    >
    <script data-rh="true" type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Use Custom Docker Images in Truss",
          "item": "https://rachfop.github.io/main"
        }
      ]
    }
    </script>
    <link rel="stylesheet" href="/assets/css/styles.20538977.css">
    <script src="/assets/js/runtime~main.8acc7b57.js" defer="defer"></script>
    <script src="/assets/js/main.2ad4ece6.js" defer="defer"></script>
  </head>
  <body class="navigation-with-keyboard">
    <svg style="display: none;">
      <defs>
        <symbol id="theme-svg-external-link" viewBox="0 0 24 24">
          <path
            fill="currentColor"
            d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"
          />
        </symbol>
      </defs>
    </svg>
    <script>
    !function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()
    </script>
    <div id="__docusaurus">
      <div role="region" aria-label="Skip to main content">
        <a
          class="skipToContent_fXgn"
          href="#__docusaurus_skipToContent_fallback"
        >Skip to main content</a>
      </div>
      <nav
        aria-label="Main"
        class="theme-layout-navbar navbar navbar--fixed-top"
      >
        <div class="navbar__inner">
          <div class="theme-layout-navbar-left navbar__items">
            <a class="navbar__brand" href="/"></a>
          </div>
          <div class="theme-layout-navbar-right navbar__items navbar__items--right">
            <div class="toggle_vylO colorModeToggle_DEke">
              <button
                class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS"
                type="button"
                disabled=""
                title="system mode"
                aria-label="Switch between dark and light mode (currently system mode)"
              >
                <svg
                  viewBox="0 0 24 24"
                  width="24"
                  height="24"
                  aria-hidden="true"
                  class="toggleIcon_g3eP lightToggleIcon_pyhR"
                >
                  <path
                    fill="currentColor"
                    d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"
                  >
                  </path>
                </svg>
                <svg
                  viewBox="0 0 24 24"
                  width="24"
                  height="24"
                  aria-hidden="true"
                  class="toggleIcon_g3eP darkToggleIcon_wfgR"
                >
                  <path
                    fill="currentColor"
                    d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"
                  >
                  </path>
                </svg>
                <svg
                  viewBox="0 0 24 24"
                  width="24"
                  height="24"
                  aria-hidden="true"
                  class="toggleIcon_g3eP systemToggleIcon_QzmC"
                >
                  <path
                    fill="currentColor"
                    d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"
                  >
                  </path>
                </svg>
              </button>
            </div>
            <div class="navbarSearchContainer_Bca1"></div>
          </div>
        </div>
        <div role="presentation" class="navbar-sidebar__backdrop"></div>
      </nav>
      <div
        id="__docusaurus_skipToContent_fallback"
        class="theme-layout-main main-wrapper mainWrapper_z2l0"
      >
        <div class="docsWrapper_hBAB">
          <button
            aria-label="Scroll back to top"
            class="clean-btn theme-back-to-top-button backToTopButton_sjWU"
            type="button"
          >
          </button>
          <div class="docRoot_UBD9">
            <aside class="theme-doc-sidebar-container docSidebarContainer_YfHR">
              <div class="sidebarViewport_aRkj">
                <div class="sidebar_njMd">
                  <nav
                    aria-label="Docs sidebar"
                    class="menu thin-scrollbar menu_SIkG"
                  >
                    <ul class="theme-doc-sidebar-menu menu__list">
                      <li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item">
                        <a class="menu__link" href="/"><span
                            title="Use Custom Docker Images in Truss"
                            class="linkLabel_WmDU"
                          >Use Custom Docker Images in Truss</span></a>
                      </li>
                      <li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item">
                        <a
                          class="menu__link menu__link--active"
                          aria-current="page"
                          href="/main"
                        ><span
                            title="Use Custom Docker Images in Truss"
                            class="linkLabel_WmDU"
                          >Use Custom Docker Images in Truss</span></a>
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>
            </aside>
            <main class="docMainContainer_TBSr">
              <div class="container padding-top--md padding-bottom--lg">
                <div class="row">
                  <div class="col docItemCol_VOVn">
                    <div class="docItemContainer_Djhp">
                      <article>
                        <nav
                          class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl"
                          aria-label="Breadcrumbs"
                        >
                          <ul class="breadcrumbs">
                            <li class="breadcrumbs__item">
                              <a
                                aria-label="Home page"
                                class="breadcrumbs__link"
                                href="/"
                              ><svg
                                  viewBox="0 0 24 24"
                                  class="breadcrumbHomeIcon_YNFT"
                                >
                                  <path
                                    d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z"
                                    fill="currentColor"
                                  >
                                  </path>
                                </svg></a>
                            </li>
                            <li class="breadcrumbs__item breadcrumbs__item--active">
                              <span class="breadcrumbs__link"
                              >Use Custom Docker Images in Truss</span>
                            </li>
                          </ul>
                        </nav>
                        <div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo">
                          <button
                            type="button"
                            class="clean-btn tocCollapsibleButton_TO0P"
                          >
                            On this page
                          </button>
                        </div>
                        <div class="theme-doc-markdown markdown">
                          <header>
                            <h1>Use Custom Docker Images in Truss</h1>
                          </header>
                          <p>
                            By default, Truss uses pre-built base images from <a
                              href="https://hub.docker.com/r/baseten/truss-server-base"
                              target="_blank"
                              rel="noopener noreferrer"
                              class=""
                            ><code>baseten/truss-server-base</code></a> that are
                            optimized for ML workloads.<br>
                            <!-- -->These images come in different variants for
                            Python versions (3.9, 3.10, 3.11) and include GPU
                            support when needed.
                          </p>
                          <p>
                            The default images are Debian-based and include
                            common dependencies like build tools, Git, and cURL.
                            For most workloads, this is sufficient ‚Äî however,
                            there are times when you need to use a <strong
                            >custom Docker image</strong>.
                          </p>
                          <p>
                            You should consider using a custom Docker image
                            when:
                          </p>
                          <ul>
                            <li class="">
                              <strong>You need specific system
                                dependencies</strong> not included in the
                              default images
                            </li>
                            <li class="">
                              <strong>You want to use a different base
                                OS</strong> or distribution
                            </li>
                            <li class="">
                              <strong>You have pre-configured
                                environments</strong> from other projects
                            </li>
                            <li class="">
                              <strong>You need to optimize image size</strong>
                              for specific use cases
                            </li>
                            <li class="">
                              <strong>You require specific versions</strong> of
                              system libraries or tools
                            </li>
                          </ul>
                          <hr>
                          <h2
                            class="anchor anchorTargetStickyNavbar_Vzrq"
                            id="requirements"
                          >
                            Requirements<a
                              href="#requirements"
                              class="hash-link"
                              aria-label="Direct link to Requirements"
                              title="Direct link to Requirements"
                              translate="no"
                            >‚Äã</a>
                          </h2>
                          <p>Your Docker image must meet these requirements:</p>
                          <ol>
                            <li class="">
                              <strong>Debian-based OS</strong> ‚Äî the image must
                              be Debian or Debian-like (validated at build
                              time).
                            </li>
                            <li class="">
                              <strong>Python 3.8‚Äì3.13</strong> ‚Äî must have a
                              compatible Python version installed.
                            </li>
                            <li class="">
                              <strong>Absolute Python path</strong> ‚Äî if the
                              Python executable isn&#x27;t at the default
                              location, you must specify its absolute path.
                            </li>
                          </ol>
                          <hr>
                          <h2
                            class="anchor anchorTargetStickyNavbar_Vzrq"
                            id="customize-your-docker-image"
                          >
                            Customize Your Docker Image<a
                              href="#customize-your-docker-image"
                              class="hash-link"
                              aria-label="Direct link to Customize Your Docker Image"
                              title="Direct link to Customize Your Docker Image"
                              translate="no"
                            >‚Äã</a>
                          </h2>
                          <p>
                            Truss allows you to specify your Docker image in two
                            ways.
                          </p>
                          <!-- -->
                          <div class="theme-tabs-container tabs-container tabList__CuJ">
                            <ul
                              role="tablist"
                              aria-orientation="horizontal"
                              class="tabs"
                            >
                              <li
                                role="tab"
                                tabindex="0"
                                aria-selected="true"
                                class="tabs__item tabItem_LNqP tabs__item--active"
                              >
                                Standard Truss
                              </li>
                              <li
                                role="tab"
                                tabindex="-1"
                                aria-selected="false"
                                class="tabs__item tabItem_LNqP"
                              >
                                Truss Chains
                              </li>
                            </ul>
                            <div class="margin-top--md">
                              <div role="tabpanel" class="tabItem_Ymn6">
                                <h3
                                  class="anchor anchorTargetStickyNavbar_Vzrq"
                                  id="-standard-truss"
                                >
                                  üß© Standard Truss<a
                                    href="#-standard-truss"
                                    class="hash-link"
                                    aria-label="Direct link to üß© Standard Truss"
                                    title="Direct link to üß© Standard Truss"
                                    translate="no"
                                  >‚Äã</a>
                                </h3>
                                <h4
                                  class="anchor anchorTargetStickyNavbar_Vzrq"
                                  id="step-1-choose-your-base-image"
                                >
                                  Step 1: Choose Your Base Image<a
                                    href="#step-1-choose-your-base-image"
                                    class="hash-link"
                                    aria-label="Direct link to Step 1: Choose Your Base Image"
                                    title="Direct link to Step 1: Choose Your Base Image"
                                    translate="no"
                                  >‚Äã</a>
                                </h4>
                                <p>
                                  Select a Docker image from <a
                                    href="https://hub.docker.com/"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class=""
                                  >Docker Hub</a> or your private registry.
                                </p>
                                <div
                                  class="language-bash codeBlockContainer_Ckt0 theme-code-block"
                                  style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                >
                                  <div class="codeBlockContent_QJqH">
                                    <pre
                                      tabindex="0"
                                      class="prism-code language-bash codeBlock_bY9V thin-scrollbar"
                                      style="color:#bfc7d5;background-color:#292d3e"
                                    ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">python:3.11-bookworm</span><br></span></code></pre>
                                  </div>
                                </div>
                                <p>or a custom image such as:</p>
                                <div
                                  class="language-bash codeBlockContainer_Ckt0 theme-code-block"
                                  style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                >
                                  <div class="codeBlockContent_QJqH">
                                    <pre
                                      tabindex="0"
                                      class="prism-code language-bash codeBlock_bY9V thin-scrollbar"
                                      style="color:#bfc7d5;background-color:#292d3e"
                                    ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">nvcr.io/nvidia/nemo:23.03</span><br></span></code></pre>
                                  </div>
                                </div>
                                <hr>
                                <h4
                                  class="anchor anchorTargetStickyNavbar_Vzrq"
                                  id="step-2-update-configyaml"
                                >
                                  Step 2: Update <code>config.yaml</code><a
                                    href="#step-2-update-configyaml"
                                    class="hash-link"
                                    aria-label="Direct link to step-2-update-configyaml"
                                    title="Direct link to step-2-update-configyaml"
                                    translate="no"
                                  >‚Äã</a>
                                </h4>
                                <p>
                                  Add the <code>base_image</code> configuration
                                  to your Truss config:
                                </p>
                                <div
                                  class="language-yaml codeBlockContainer_Ckt0 theme-code-block"
                                  style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                >
                                  <div class="codeBlockContent_QJqH">
                                    <pre
                                      tabindex="0"
                                      class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"
                                      style="color:#bfc7d5;background-color:#292d3e"
                                    ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">base_image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;python:3.11-bookworm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">python_executable_path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/usr/local/bin/python3&quot;</span><br></span></code></pre>
                                  </div>
                                </div>
                                <p>
                                  For private registries, include authentication
                                  credentials:
                                </p>
                                <div
                                  class="language-yaml codeBlockContainer_Ckt0 theme-code-block"
                                  style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                >
                                  <div class="codeBlockContent_QJqH">
                                    <pre
                                      tabindex="0"
                                      class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"
                                      style="color:#bfc7d5;background-color:#292d3e"
                                    ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">base_image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;your-registry.com/your-image:tag&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">python_executable_path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/usr/local/bin/python3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">docker_auth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">username</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;your-username&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;your-password&quot;</span><br></span></code></pre>
                                  </div>
                                </div>
                                <blockquote>
                                  <p>
                                    üí° <strong>Example:</strong>
                                    See <code
                                    >src/standard-truss/config.yaml</code> for a
                                    minimal but valid Truss configuration that
                                    includes the <code>base_image</code> block.
                                  </p>
                                </blockquote>
                                <hr>
                                <h4
                                  class="anchor anchorTargetStickyNavbar_Vzrq"
                                  id="example-gpu-enabled-config"
                                >
                                  Example: GPU-Enabled Config<a
                                    href="#example-gpu-enabled-config"
                                    class="hash-link"
                                    aria-label="Direct link to Example: GPU-Enabled Config"
                                    title="Direct link to Example: GPU-Enabled Config"
                                    translate="no"
                                  >‚Äã</a>
                                </h4>
                                <div
                                  class="language-yaml codeBlockContainer_Ckt0 theme-code-block"
                                  style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                >
                                  <div class="codeBlockContent_QJqH">
                                    <pre
                                      tabindex="0"
                                      class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"
                                      style="color:#bfc7d5;background-color:#292d3e"
                                    ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">config_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">model_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> custom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">base</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">example</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">python_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">python_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> py38</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">requirements</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> PySoundFile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">accelerator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> T4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2500m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;4512Mi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">use_gpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">base_image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nvcr.io/nvidia/nemo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">23.03</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">python_executable_path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /usr/bin/python</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">apply_library_patches</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">system_packages</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> python3.8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">venv</span><br></span></code></pre>
                                  </div>
                                </div>
                                <hr>
                                <h4
                                  class="anchor anchorTargetStickyNavbar_Vzrq"
                                  id="step-3-build-and-run-the-model"
                                >
                                  Step 3: Build and Run the Model<a
                                    href="#step-3-build-and-run-the-model"
                                    class="hash-link"
                                    aria-label="Direct link to Step 3: Build and Run the Model"
                                    title="Direct link to Step 3: Build and Run the Model"
                                    translate="no"
                                  >‚Äã</a>
                                </h4>
                                <p><strong>Build the Docker image:</strong></p>
                                <div
                                  class="language-bash codeBlockContainer_Ckt0 theme-code-block"
                                  style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                >
                                  <div class="codeBlockContent_QJqH">
                                    <pre
                                      tabindex="0"
                                      class="prism-code language-bash codeBlock_bY9V thin-scrollbar"
                                      style="color:#bfc7d5;background-color:#292d3e"
                                    ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">truss image build path/to/your/truss --tag custom-base-image-example:latest</span><br></span></code></pre>
                                  </div>
                                </div>
                                <blockquote>
                                  <p>
                                    ‚ö†Ô∏è <strong>Platform Note:</strong>
                                    If you&#x27;re building on an Apple Silicon
                                    (M1/M2) Mac or targeting GPUs, you may need
                                    to specify the correct platform:
                                  </p>
                                  <div
                                    class="language-bash codeBlockContainer_Ckt0 theme-code-block"
                                    style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                  >
                                    <div class="codeBlockContent_QJqH">
                                      <pre
                                        tabindex="0"
                                        class="prism-code language-bash codeBlock_bY9V thin-scrollbar"
                                        style="color:#bfc7d5;background-color:#292d3e"
                                      ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">truss image build path/to/your/truss --tag custom-base-image-example:latest --platform linux/amd64</span><br></span></code></pre>
                                    </div>
                                  </div>
                                  <p>
                                    Otherwise, Docker may attempt to build for
                                    <code>arm64</code>, which can cause runtime
                                    incompatibilities.
                                  </p>
                                </blockquote>
                                <p>
                                  <strong>Run the Truss container
                                    locally:</strong>
                                </p>
                                <div
                                  class="language-bash codeBlockContainer_Ckt0 theme-code-block"
                                  style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                >
                                  <div class="codeBlockContent_QJqH">
                                    <pre
                                      tabindex="0"
                                      class="prism-code language-bash codeBlock_bY9V thin-scrollbar"
                                      style="color:#bfc7d5;background-color:#292d3e"
                                    ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">truss image run path/to/your/truss --tag custom-base-image-example:latest --port 8080</span><br></span></code></pre>
                                  </div>
                                </div>
                                <p>
                                  After it starts, your model will be available
                                  at:
                                </p>
                                <div
                                  class="language-text codeBlockContainer_Ckt0 theme-code-block"
                                  style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                >
                                  <div class="codeBlockContent_QJqH">
                                    <pre
                                      tabindex="0"
                                      class="prism-code language-text codeBlock_bY9V thin-scrollbar"
                                      style="color:#bfc7d5;background-color:#292d3e"
                                    ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:8080/v1/models/custom-base-image-example/predict</span><br></span></code></pre>
                                  </div>
                                </div>
                                <p><strong>Equivalent using Python:</strong></p>
                                <div
                                  class="language-python codeBlockContainer_Ckt0 theme-code-block"
                                  style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                >
                                  <div class="codeBlockContent_QJqH">
                                    <pre
                                      tabindex="0"
                                      class="prism-code language-python codeBlock_bY9V thin-scrollbar"
                                      style="color:#bfc7d5;background-color:#292d3e"
                                    ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> truss </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> TrussHandle</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">th </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TrussHandle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;path/to/your/truss&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">th</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">set_base_image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;python:3.11-bookworm&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/usr/local/bin/python3&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">th</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">docker_run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">local_port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">8080</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre>
                                  </div>
                                </div>
                              </div>
                              <div
                                role="tabpanel"
                                class="tabItem_Ymn6"
                                hidden=""
                              >
                                <h3
                                  class="anchor anchorTargetStickyNavbar_Vzrq"
                                  id="-truss-chains"
                                >
                                  üß© Truss Chains<a
                                    href="#-truss-chains"
                                    class="hash-link"
                                    aria-label="Direct link to üß© Truss Chains"
                                    title="Direct link to üß© Truss Chains"
                                    translate="no"
                                  >‚Äã</a>
                                </h3>
                                <h4
                                  class="anchor anchorTargetStickyNavbar_Vzrq"
                                  id="step-1-define-your-custom-image"
                                >
                                  Step 1: Define Your Custom Image<a
                                    href="#step-1-define-your-custom-image"
                                    class="hash-link"
                                    aria-label="Direct link to Step 1: Define Your Custom Image"
                                    title="Direct link to Step 1: Define Your Custom Image"
                                    translate="no"
                                  >‚Äã</a>
                                </h4>
                                <div
                                  class="language-python codeBlockContainer_Ckt0 theme-code-block"
                                  style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                >
                                  <div class="codeBlockContent_QJqH">
                                    <pre
                                      tabindex="0"
                                      class="prism-code language-python codeBlock_bY9V thin-scrollbar"
                                      style="color:#bfc7d5;background-color:#292d3e"
                                    ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> truss_chains </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> chains</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IMAGE_CUSTOM </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> chains</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">DockerImage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    base_image</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">chains</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CustomImage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        image</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;python:3.11-slim-bookworm&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        python_executable_path</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/usr/local/bin/python&quot;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pip_requirements_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">chains</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">make_abs_path_here</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;requirements.txt&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre>
                                  </div>
                                </div>
                                <h4
                                  class="anchor anchorTargetStickyNavbar_Vzrq"
                                  id="step-2-apply-it-to-your-chainlet"
                                >
                                  Step 2: Apply It to Your Chainlet<a
                                    href="#step-2-apply-it-to-your-chainlet"
                                    class="hash-link"
                                    aria-label="Direct link to Step 2: Apply It to Your Chainlet"
                                    title="Direct link to Step 2: Apply It to Your Chainlet"
                                    translate="no"
                                  >‚Äã</a>
                                </h4>
                                <div
                                  class="language-python codeBlockContainer_Ckt0 theme-code-block"
                                  style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"
                                >
                                  <div class="codeBlockContent_QJqH">
                                    <pre
                                      tabindex="0"
                                      class="prism-code language-python codeBlock_bY9V thin-scrollbar"
                                      style="color:#bfc7d5;background-color:#292d3e"
                                    ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyChainlet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">chains</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ChainletBase</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    remote_config </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> chains</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RemoteConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        docker_image</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">IMAGE_CUSTOM</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">run_remote</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">upper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre>
                                  </div>
                                </div>
                                <blockquote>
                                  <p>
                                    üîç See <code>src/truss-chains/</code> for
                                    working examples of custom image
                                    configurations.
                                  </p>
                                </blockquote>
                              </div>
                            </div>
                          </div>
                        </div>
                      </article>
                      <nav
                        class="docusaurus-mt-lg pagination-nav"
                        aria-label="Docs pages"
                      >
                        <a
                          class="pagination-nav__link pagination-nav__link--prev"
                          href="/"
                        ><div class="pagination-nav__sublabel">
                            Previous
                          </div><div class="pagination-nav__label">
                            Use Custom Docker Images in Truss
                          </div></a>
                      </nav>
                    </div>
                  </div>
                  <div class="col col--3">
                    <div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop">
                      <ul class="table-of-contents table-of-contents__left-border">
                        <li>
                          <a
                            href="#requirements"
                            class="table-of-contents__link toc-highlight"
                          >Requirements</a>
                        </li>
                        <li>
                          <a
                            href="#customize-your-docker-image"
                            class="table-of-contents__link toc-highlight"
                          >Customize Your Docker Image</a><ul>
                            <li>
                              <a
                                href="#-standard-truss"
                                class="table-of-contents__link toc-highlight"
                              >üß© Standard Truss</a>
                            </li>
                            <li>
                              <a
                                href="#-truss-chains"
                                class="table-of-contents__link toc-highlight"
                              >üß© Truss Chains</a>
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </main>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
